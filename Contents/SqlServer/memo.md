---
layout: default
title: ":bar_chart: Microsoft SQL Server"
description: ":exclamation: Microsoft SQL Server注意点・他"
date: "2020/05/17"
lastmod: "2020/05/17"
---

## 1. .NETアプリの接続文字列

MultipleActiveResultSets=True(MARS機能)にすると、１つの接続のみを使用し1つ目のDataReaderの結果セットを  
アクティブ化した状態で2つ目の結果セットもアクティブ化することができる。  
要は、DataReader(JavaではResultSet{未確認})を閉じないでもう１つのDataReaderを使用することができる。  
これがfalseのままだと、DataReaderが既に開かれていますというInvalidOperationException例外が発生する。  
SQLServer2005以降のADO.NET2.0以降で追加された機能。  
SQLServer2000では、1 つの結果セットしか同時にアクティブ化出来ない制約があったため複数の結果セットを  
アクティブ化したい場合2 つの接続を使用する必要がある。  
しかも、接続が複数に分かれるため、トランザクション制御や排他制御などを考慮した上で使用する必要がある。  

<br />

## 2. 軽量のSQLServerデータベースであるLocalDBのデフォルトインスタンス名

-   SQL Server2012LocalDBと2014LocalDBのインストール時に自動生成されるデフォルトインスタンス名  
    SQLServer2012 LocalDBは**v11.0**  
    SQLServer2014 LocalDBは**MSSQLLocalDB**(v12.0ではない)  
    ※未確認だが2016以上もデフォルトでは2014と同じと思われる。  

-   LocalDBの名前付きインスタンス作成はコマンドプロンプトを起動し以下を実行する。(SqlLocalDBユーティリティSqlLocalDB.exe)  

```:prompt
sqllocaldb.exe create ○○  
```

<br />

## 以下マイクロソフト抜粋

> LocalDB では、自動インスタンスと名前付きインスタンスという 2 種類のインスタンスがサポートされています。

> LocalDB の自動インスタンスはパブリックです。 ユーザーのために自動的に作成および管理され、任意のアプリケーションから使用できます。 
>  どのバージョンの LocalDB に対しても、ユーザーのコンピューターにインストールされている LocalDB の自動インスタンスが 1 つ存在します。
>  LocalDB の自動インスタンスを使用すると、シームレスなインスタンス管理を実行できます。 インスタンスを作成する必要はありません。それだけで動作します。 
>  これにより、アプリケーションのインストールと別のコンピューターへの移行が簡単になります。 
>  対象コンピューターに指定バージョンの LocalDB がインストールされている場合、その対象コンピューターでも同じバージョンの LocalDB の自動インスタンスを使用できます。
>  LocalDB の自動インスタンスのインスタンス名には特殊なパターンがあり、これは予約済み名前空間に属します。 
>  これにより、LocalDB の名前付きインスタンスとの名前の競合を防ぎます。
>  自動インスタンスは、xx.x という形式の LocalDB リリース バージョン番号の前に v という 1 文字が付いた名前になります。 たとえば、v11.0 は SQL Server 2012 を表します。

> LocalDB の名前付きインスタンスはプライベートです。 これらは、そのインスタンスの作成と管理を行う単一のアプリケーションによって所有されます。
>  名前付きインスタンスは他のインスタンスからの分離を可能にし、他のデータベース ユーザーとのリソースの競合を減らすことによってパフォーマンスを向上させることができます。
>  名前付きインスタンスは、ユーザーが LocalDB 管理 API を通じて明示的に作成するか、マネージ アプリケーションの app.config ファイルを通じて暗黙的に作成する必要があります
>  (ただし、マネージ アプリケーションでは必要に応じて API も使用できます)。 
>  LocalDB の各名前付きインスタンスには、LocalDB バイナリの特定のセットを指す特定の LocalDB バージョンが関連付けられています。 
>  LocalDB のインスタンス名は sysname データ型で、最大文字数は 128 文字です
>  (これは、名前を 16 文字の ASCII 文字から構成される通常の NetBIOS 名に制限する SQL Server の通常の名前付きインスタンスとは異なります)。
>  LocalDB のインスタンス名には、ファイル名内で有効な任意の Unicode 文字を使用できます。 自動インスタンス名を使用する名前付きインスタンスは、自動インスタンスになります。

> コンピューターの異なるユーザーが同じ名前のインスタンスを持つことができます。 各インスタンスは、別のユーザーとして実行している別のプロセスです。

* * *
